<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Group Rating</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="script.js"></script>
    <style>
        /* General styling */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        /* Center the dev and report values */
        td .dev-value, td .report-value {
            display: block; /* Treat the span as a block-level element */
            text-align: center; /* Center the text */
            width: 100%;  /* Make the span fill the available width */
        }


        input[type="text"] {
            width: 100%;  /* Make the input fill the available width */
            padding: 8px;  /* Add some padding for better readability */
            font-size: 14px;  /* Set a comfortable font size */
            box-sizing: border-box;  /* Ensure padding doesn't overflow the input */
        }

        /* Styling for disabled export button */
        #exportButton[disabled] {
            background-color: #d3d3d3;
            color: #888;
            cursor: not-allowed;
        }

        /* Styling for active export button */
        #exportButton {
            background-color: #4CAF50; /* Green background */
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            cursor: pointer;
            font-size: 16px;
        }

    </style>
</head>
<body>
    <h2>Rate Your Group Members</h2>

    <p>Please provide accurate and descriptive ratings for each of your group members.
        This form will help you ensure that your ratings are in the correct format and sum to 100. Don't forget to
        select your name so we know who is doing the reviewing. While the comment boxes do not check length, make sure
    that you are providing meaningful explanations for your ratings, especially for scores that deviate significantly from
    the expected value. Submissions with mostly copy-pasted or empty boxes will be not be accepted and will result in a zero.</p>

    <p>Please upload the CSV provided to you. The file must have the first column of names (use underscore instead of spaces) and the second column of groups.</p>

    <!-- CSV Upload -->
    <label for="csvUpload">Upload CSV:</label>
    <input type="file" id="csvUpload" accept=".csv"><br><br>

    <!-- Group Selection Dropdown -->
    <label for="groupSelect">Select Group:</label>
    <select id="groupSelect" disabled>
        <option value="">--Select Group--</option>
    </select>

    <!-- Reviewer Selection Dropdown -->
    <label for="reviewerSelect">Select Your Name:</label>
    <select id="reviewerSelect" disabled>
        <option value="">--Select Reviewer--</option>
    </select>

    <!-- Dynamic Rating Table -->
    <table border="1" id="ratingTable" style="margin-top: 20px; display: none;">
        <thead>
            <tr>
                <th>Member Name</th>
                <th>Dev</th>
                <th>Dev Value</th>
                <th>Report</th>
                <th>Report Value</th>
                <th>Dev Comments</th>
                <th>Report Comments</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Rows will be inserted here by JavaScript -->
        </tbody>
    </table>
    <div style="margin-top: 20px;">
        <strong>Dev Total: </strong><span id="devTotal">0</span>
    </div>
    <div>
        <strong>Report Total: </strong><span id="reportTotal">0</span>
    </div>

    <button id="exportButton" style="margin-top: 20px;" disabled>Export as CSV</button>


<script>
        let groupMap = {}; // { groupName: [member1, member2,...] }

        // --- Parse uploaded CSV and populate dropdowns ---
        $("#csvUpload").on("change", function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                const lines = event.target.result.split(/\r?\n/).filter(line => line.trim() !== "");
                groupMap = {};

                lines.forEach(line => {
                    const parts = line.split(",").map(s => s.trim());
                    if (parts.length >= 2) {
                        const name = parts[0];
                        const group = parts[1];
                        if (!groupMap[group]) groupMap[group] = [];
                        groupMap[group].push(name);
                    }
                });

                // Populate group dropdown
                const groupSelect = $("#groupSelect");
                groupSelect.empty().append('<option value="">--Select Group--</option>');
                Object.keys(groupMap).forEach(group => {
                    groupSelect.append(`<option value="${group}">${group}</option>`);
                });
                groupSelect.prop("disabled", false);
            };
            reader.readAsText(file);
        });

        // --- When group selected, populate reviewer dropdown ---
        $("#groupSelect").on("change", function() {
            const group = $(this).val();
            const reviewerSelect = $("#reviewerSelect");
            reviewerSelect.empty().append('<option value="">--Select Reviewer--</option>');

            if (group && groupMap[group]) {
                groupMap[group].forEach(name => {
                    reviewerSelect.append(`<option value="${name}">${name}</option>`);
                });
                reviewerSelect.prop("disabled", false);
            } else {
                reviewerSelect.prop("disabled", true);
            }
        });
    </script>
</body>
</html>
